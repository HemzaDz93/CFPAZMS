{% extends 'base.html' %}

{% block title %}Ø§Ù„ÙˆØµÙ„ Ø§Ù„Ø´Ù‡Ø±ÙŠ - {{ employee.full_name }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Ø±Ø£Ø³ Ø§Ù„ÙˆØµÙ„ -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <h2 class="page-title">ğŸ§¾ Ø§Ù„ÙˆØµÙ„ Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„Ù„ÙˆØ¬Ø¨Ø§Øª</h2>
                <button class="btn btn-primary" onclick="window.print()">
                    <i class="bi bi-printer"></i> Ø·Ø¨Ø§Ø¹Ø©
                </button>
            </div>
        </div>
    </div>

    <!-- Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù ÙˆØ§Ù„ÙØªØ±Ø© -->
    <div class="card shadow-sm mb-4 border-0">
        <div class="card-body">
            <div class="row">
                <div class="col-md-6">
                    <h6 class="text-muted">Ø§Ù„Ù…ÙˆØ¸Ù</h6>
                    <h4>{{ employee.full_name }}</h4>
                    <p class="text-muted">
                        <small>Ø§Ù„Ù…Ù†ØµØ¨: {{ employee.position or employee.role }}</small><br>
                        <small>Ø§Ù„Ù‚Ø³Ù…: {{ employee.department or 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯' }}</small>
                    </p>
                </div>
                <div class="col-md-6 text-md-end">
                    <h6 class="text-muted">Ø§Ù„ÙØªØ±Ø©</h6>
                    <h4>{{ start_date.strftime('%B %Y') }}</h4>
                    <p class="text-muted">
                        <small>Ù…Ù†: {{ start_date.strftime('%d/%m/%Y') }}</small><br>
                        <small>Ø¥Ù„Ù‰: {{ end_date.strftime('%d/%m/%Y') }}</small>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- Ù…Ù„Ø®Øµ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… -->
    <div class="row mb-4">
        <div class="col-md-3 mb-3">
            <div class="card text-center border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª</h6>
                    <h2 class="text-primary mb-2">{{ total_meals }}</h2>
                    <small class="text-muted">ÙˆØ¬Ø¨Ø©</small>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card text-center border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„ÙƒÙ„ÙŠØ©</h6>
                    <h2 class="text-success mb-2">{{ "%.2f"|format(total_cost) }}</h2>
                    <small class="text-muted">Ø¯Ø¬</small>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card text-center border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted">Ø§Ù„Ù…Ø¯ÙÙˆØ¹Ø©</h6>
                    <h2 class="text-info mb-2">{{ settled_count }}</h2>
                    <small class="text-muted">{{ "%.2f"|format(settled_count * meal_cost_unit) }} Ø¯Ø¬</small>
                </div>
            </div>
        </div>

        <div class="col-md-3 mb-3">
            <div class="card text-center border-0 shadow-sm">
                <div class="card-body">
                    <h6 class="text-muted">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©</h6>
                    <h2 class="text-danger mb-2">{{ unsettled_count }}</h2>
                    <small class="text-muted">{{ "%.2f"|format(unsettled_cost) }} Ø¯Ø¬</small>
                </div>
            </div>
        </div>
    </div>

    <!-- ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª -->
    <div class="card shadow-sm mb-4 border-0">
        <div class="card-header bg-light">
            <h5 class="mb-0">ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-sm mb-0">
                <thead class="table-light">
                    <tr>
                        <th width="15%">Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th width="15%">Ø¹Ø¯Ø¯ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª</th>
                        <th width="15%">Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ÙˆØ­Ø¯Ø©</th>
                        <th width="20%">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                        <th width="15%">Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th width="20%">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    {% if transactions %}
                        {% for trans in transactions %}
                            <tr>
                                <td>{{ trans.transaction_date.strftime('%d/%m/%Y') }}</td>
                                <td>
                                    <span class="badge bg-info">{{ (trans.meal_cost / meal_cost_unit) | int }}</span>
                                </td>
                                <td>{{ meal_cost_unit }} Ø¯Ø¬</td>
                                <td><strong>{{ "%.2f"|format(trans.final_cost) }} Ø¯Ø¬</strong></td>
                                <td>
                                    {% if trans.is_settled %}
                                        <span class="badge bg-success">âœ“ Ù…Ø¯ÙÙˆØ¹Ø©</span>
                                    {% else %}
                                        <span class="badge bg-warning">Ù…Ø¹Ù„Ù‚Ø©</span>
                                    {% endif %}
                                </td>
                                <td><small class="text-muted">{{ trans.notes[:20] if trans.notes else '-' }}</small></td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="6" class="text-center text-muted py-3">
                                Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¹Ù…Ù„ÙŠØ§Øª ÙÙŠ Ù‡Ø°Ù‡ Ø§Ù„ÙØªØ±Ø©
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
                <tfoot class="table-light">
                    <tr>
                        <th colspan="2">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                        <th>{{ meal_cost_unit }} Ø¯Ø¬</th>
                        <th><strong>{{ "%.2f"|format(total_cost) }} Ø¯Ø¬</strong></th>
                        <th colspan="2"></th>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
    <div class="card shadow-sm border-0 mb-4">
        <div class="card-body">
            <h6 class="text-muted mb-3">Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ù…Ù‡Ù…Ø©:</h6>
            <ul class="small">
                <li>ÙŠØªÙ… Ø§Ø­ØªØ³Ø§Ø¨ Ø§Ù„ÙˆØ¬Ø¨Ø© Ø§Ù„ÙˆØ§Ø­Ø¯Ø© Ø¨Ù€ <strong>{{ meal_cost_unit }} Ø¯Ø¬</strong> Ø«Ø§Ø¨ØªØ©</li>
                <li>ÙŠØªÙ… Ø®ØµÙ… Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ (<strong>{{ "%.2f"|format(unsettled_cost) }} Ø¯Ø¬</strong>) Ù…Ù† Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ</li>
                <li>Ù‡Ø°Ø§ Ø§Ù„ÙˆØµÙ„ ØµØ§Ù„Ø­ ÙƒØ¥Ø«Ø¨Ø§Øª Ø¯ÙØ¹ Ø§Ù„Ù…ÙˆØ¸Ù</li>
                <li>ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø³ØªÙØ³Ø§Ø±ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ§Ø±Ø¯ Ø§Ù„Ø¨Ø´Ø±ÙŠØ©</li>
            </ul>
        </div>
    </div>

    <!-- Ø§Ù„Ø£Ø²Ø±Ø§Ø± -->
    <div class="row mt-4">
        <div class="col-md-8 mx-auto">
            <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                <a href="{{ url_for('employee_meals.employee_summary', employee_id=employee.id) }}" class="btn btn-primary">
                    <i class="bi bi-bar-chart"></i> Ø§Ù„Ù…Ù„Ø®Øµ Ø§Ù„Ø´Ø§Ù…Ù„
                </a>
                <a href="{{ url_for('employee_meals.meals_list') }}" class="btn btn-secondary">
                    <i class="bi bi-arrow-left"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù‚Ø§Ø¦Ù…Ø©
                </a>
            </div>
        </div>
    </div>
</div>

<style>
    @media print {
        .btn, .navbar, .no-print {
            display: none !important;
        }
        body {
            background: white;
        }
        .container-fluid {
            max-width: 100%;
        }
    }
</style>
{% endblock %}