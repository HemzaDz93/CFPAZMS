{% extends 'base.html' %}

{% block title %}Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„ÙˆØ¬Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row mb-4">
        <div class="col-12">
            <h2 class="page-title">ğŸ“Š Ø§Ù„ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ø´Ù‡Ø±ÙŠ Ù„ÙˆØ¬Ø¨Ø§Øª Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h2>
            <p class="text-muted">
                Ø§Ù„ÙØªØ±Ø©: Ù…Ù† {{ start_date.strftime('%d/%m/%Y') }} Ø¥Ù„Ù‰ {{ end_date.strftime('%d/%m/%Y') }}
            </p>
        </div>
    </div>

    <!-- Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ù…Ù„Ø®Øµ -->
    <div class="row mb-4">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-egg-fried text-warning" style="font-size: 2rem;"></i>
                    <h6 class="text-muted mt-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ÙˆØ¬Ø¨Ø§Øª</h6>
                    <h3 class="text-primary">{{ grand_total_meals }}</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-cash-coin text-success" style="font-size: 2rem;"></i>
                    <h6 class="text-muted mt-2">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªÙƒÙ„ÙØ©</h6>
                    <h3 class="text-success">{{ "%.2f"|format(grand_total_cost) }} Ø¯Ø¬</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-check-circle text-info" style="font-size: 2rem;"></i>
                    <h6 class="text-muted mt-2">Ø§Ù„Ù…Ø¯ÙÙˆØ¹</h6>
                    <h3 class="text-info">{{ "%.2f"|format(grand_settled_cost) }} Ø¯Ø¬</h3>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm">
                <div class="card-body text-center">
                    <i class="bi bi-hourglass-split text-danger" style="font-size: 2rem;"></i>
                    <h6 class="text-muted mt-2">Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</h6>
                    <h3 class="text-danger">{{ "%.2f"|format(grand_unsettled_cost) }} Ø¯Ø¬</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„ØªÙØ§ØµÙŠÙ„ -->
    <div class="card border-0 shadow-sm mb-4">
        <div class="card-header bg-light border-bottom">
            <h5 class="mb-0">ğŸ“‹ ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th style="width: 25%;">Ø§Ù„Ù…ÙˆØ¸Ù</th>
                        <th style="width: 10%;" class="text-center">Ø§Ù„ÙˆØ¬Ø¨Ø§Øª</th>
                        <th style="width: 15%;" class="text-end">Ø§Ù„ØªÙƒÙ„ÙØ© Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠØ©</th>
                        <th style="width: 10%;" class="text-center">Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
                        <th style="width: 15%;" class="text-end">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
                        <th style="width: 15%;" class="text-end">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                        <th style="width: 10%;" class="text-center">Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    {% if employee_stats %}
                        {% for emp_id, stats in employee_stats %}
                            <tr>
                                <td>
                                    <strong>{{ stats.employee.full_name }}</strong>
                                    <br>
                                    <small class="text-muted">{{ stats.employee.position or stats.employee.role }}</small>
                                </td>
                                <td class="text-center">
                                    <span class="badge bg-info">{{ stats.total_meals }}</span>
                                </td>
                                <td class="text-end">
                                    <strong class="text-success">{{ "%.2f"|format(stats.total_cost) }} Ø¯Ø¬</strong>
                                </td>
                                <td class="text-center">
                                    <span class="badge bg-success">{{ stats.settled_count }}</span>
                                </td>
                                <td class="text-end">
                                    {{ "%.2f"|format(stats.settled_cost) }} Ø¯Ø¬
                                </td>
                                <td class="text-end">
                                    <strong class="text-danger">{{ "%.2f"|format(stats.total_cost - stats.settled_cost) }} Ø¯Ø¬</strong>
                                </td>
                                <td class="text-center">
                                    <a href="{{ url_for('employee_meals.monthly_receipt', employee_id=emp_id, month=month) }}" 
                                       class="btn btn-sm btn-outline-primary" title="Ø¹Ø±Ø¶ Ø§Ù„ÙˆØµÙ„ Ø§Ù„Ø´Ù‡Ø±ÙŠ">
                                        <i class="bi bi-receipt"></i>
                                    </a>
                                </td>
                            </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="7" class="text-center text-muted py-4">
                                <i class="bi bi-inbox"></i> Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„Ø´Ù‡Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯
                            </td>
                        </tr>
                    {% endif %}
                </tbody>
                <tfoot class="table-light fw-bold">
                    <tr>
                        <td><strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</strong></td>
                        <td class="text-center">
                            <span class="badge bg-primary">{{ grand_total_meals }}</span>
                        </td>
                        <td class="text-end">
                            <strong class="text-success">{{ "%.2f"|format(grand_total_cost) }} Ø¯Ø¬</strong>
                        </td>
                        <td class="text-center">
                            <span class="badge bg-success">{{ grand_settled_count }}</span>
                        </td>
                        <td class="text-end">
                            {{ "%.2f"|format(grand_settled_cost) }} Ø¯Ø¬
                        </td>
                        <td class="text-end">
                            <strong class="text-danger">{{ "%.2f"|format(grand_unsettled_cost) }} Ø¯Ø¬</strong>
                        </td>
                        <td></td>
                    </tr>
                </tfoot>
            </table>
        </div>
    </div>

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ© (Ù„Ù„Ø·Ø¨Ø§Ø¹Ø©) -->
    <div class="card border-0 shadow-sm mb-4 d-none d-print-block">
        <div class="card-header bg-light border-bottom">
            <h5 class="mb-0">ğŸ“ Ø³Ø¬Ù„ Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª Ø§Ù„ØªÙØµÙŠÙ„ÙŠØ©</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-sm mb-0">
                <thead class="table-light">
                    <tr>
                        <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                        <th>Ø§Ù„Ù…ÙˆØ¸Ù</th>
                        <th>Ø§Ù„ÙˆØ¬Ø¨Ø§Øª</th>
                        <th>Ø§Ù„ØªÙƒÙ„ÙØ©</th>
                        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                        <th>Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª</th>
                    </tr>
                </thead>
                <tbody>
                    {% for emp_id, stats in employee_stats %}
                        {% for trans in stats.transactions %}
                            <tr>
                                <td>{{ trans.transaction_date.strftime('%d/%m/%Y') }}</td>
                                <td>{{ stats.employee.full_name }}</td>
                                <td class="text-center">{{ (trans.meal_cost / meal_cost_unit) | int }}</td>
                                <td>{{ "%.2f"|format(trans.final_cost) }} Ø¯Ø¬</td>
                                <td>
                                    {% if trans.is_settled %}
                                        Ù…Ø¯ÙÙˆØ¹Ø©
                                    {% else %}
                                        Ù…Ø¹Ù„Ù‚Ø©
                                    {% endif %}
                                </td>
                                <td>{{ trans.notes[:30] if trans.notes else '-' }}</td>
                            </tr>
                        {% endfor %}
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- ØªØµÙÙŠØ© Ø§Ù„Ø´Ù‡Ø± (Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©) -->
    <div class="row mb-4 no-print">
        <div class="col-md-6">
            <form method="GET" class="row g-2">
                <div class="col-auto">
                    <label class="form-label">ØªØµÙÙŠØ© Ø­Ø³Ø¨ Ø§Ù„Ø´Ù‡Ø±:</label>
                </div>
                <div class="col-auto">
                    <input type="month" class="form-control" name="month" value="{{ month }}">
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-funnel"></i> ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØªØµÙÙŠØ©
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª -->
    <div class="row no-print">
        <div class="col-md-8 mx-auto">
            <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                <button class="btn btn-success" onclick="window.print()">
                    <i class="bi bi-printer"></i> Ø·Ø¨Ø§Ø¹Ø© Ø§Ù„ØªÙ‚Ø±ÙŠØ±
                </button>
                <a href="{{ url_for('employee_meals.meals_list') }}" class="btn btn-secondary">
                    <i class="bi bi-list"></i> Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø¹Ø§Ù…Ù„Ø§Øª
                </a>
                <a href="{{ url_for('restaurant.meals') }}" class="btn btn-outline-secondary">
                    <i class="bi bi-arrow-left"></i> Ø±Ø¬ÙˆØ¹ Ù„Ù„Ù…Ø·Ø¹Ù…
                </a>
            </div>
        </div>
    </div>
</div>

<!-- CSS Ù„Ù„Ø·Ø¨Ø§Ø¹Ø© -->
<style>
    @media print {
        body {
            background: white;
        }
        .container-fluid {
            max-width: 100%;
        }
        .no-print {
            display: none !important;
        }
        .d-print-block {
            display: block !important;
        }
        .table {
            font-size: 0.85rem;
        }
        .page-title {
            font-size: 1.5rem;
            margin-bottom: 1rem;
        }
        .card {
            page-break-inside: avoid;
        }
        .table-responsive {
            overflow: visible;
        }
        .btn {
            display: none;
        }
    }

    /* ØªØ­Ø³ÙŠÙ†Ø§Øª Ø§Ù„ÙˆØ§Ø¬Ù‡Ø© */
    .page-title {
        color: #1a3a52;
        font-weight: 600;
        border-bottom: 3px solid #2e5f8a;
        padding-bottom: 0.5rem;
    }

    .card-header {
        background: linear-gradient(135deg, #1a3a52 0%, #2e5f8a 100%) !important;
        color: white;
    }

    .card-header h5 {
        color: white;
    }

    .table-light {
        background-color: #f8f9fa !important;
    }

    .text-end {
        text-align: right;
    }

    .text-center {
        text-align: center;
    }

    /* Ø§Ù„Ø­Ø§Ù„Ø© RTL */
    [dir="rtl"] .text-end {
        text-align: right;
    }

    [dir="rtl"] .text-center {
        text-align: center;
    }
</style>
{% endblock %}