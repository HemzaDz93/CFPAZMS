{% extends 'base.html' %}

{% block title %}إضافة توقع طلب جديد{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-md-8 offset-md-2">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-chart-line"></i> إضافة توقع طلب جديد</h5>
                </div>
                <div class="card-body">
                    <form method="post">
                        <!-- تاريخ التوقع -->
                        <div class="mb-3">
                            <label for="forecast_date" class="form-label">التاريخ المتوقع *</label>
                            <input type="date" id="forecast_date" name="forecast_date" class="form-control" required>
                        </div>

                        <!-- نوع الوجبة -->
                        <div class="mb-3">
                            <label for="meal_type" class="form-label">نوع الوجبة *</label>
                            <select id="meal_type" name="meal_type" class="form-select" required>
                                <option value="">-- اختر نوع الوجبة --</option>
                                <option value="breakfast">الإفطار</option>
                                <option value="lunch">الغداء</option>
                                <option value="dinner">العشاء</option>
                                <option value="snack">وجبة خفيفة</option>
                            </select>
                        </div>

                        <!-- عدد الحصص المتوقعة -->
                        <div class="mb-3">
                            <label for="forecasted_portions" class="form-label">عدد الحصص المتوقعة *</label>
                            <input type="number" id="forecasted_portions" name="forecasted_portions" 
                                   class="form-control" required min="1">
                            <small class="text-muted">عدد الأشخاص المتوقع إطعامهم</small>
                        </div>

                        <!-- مستوى الثقة -->
                        <div class="mb-3">
                            <label for="confidence_level" class="form-label">مستوى الثقة في التوقع (%)</label>
                            <div class="input-group">
                                <input type="range" id="confidence_level" name="confidence_level" 
                                       class="form-range" min="0" max="100" step="5" value="80">
                                <span class="input-group-text" id="confidence-display">80%</span>
                            </div>
                            <small class="text-muted">كم أنت واثق من دقة هذا التوقع؟</small>
                        </div>

                        <!-- طريقة التوقع -->
                        <div class="mb-3">
                            <label for="forecasting_method" class="form-label">طريقة التنبؤ</label>
                            <select id="forecasting_method" name="forecasting_method" class="form-select">
                                <option value="statistical">إحصائي (بناءً على البيانات التاريخية)</option>
                                <option value="ml_based">آلي (بناءً على خوارزميات التعلم الآلي)</option>
                                <option value="manual">يدوي (بناءً على الخبرة)</option>
                                <option value="historical_average">متوسط تاريخي</option>
                            </select>
                        </div>

                        <!-- عوامل إضافية -->
                        <div class="card bg-light mb-3">
                            <div class="card-body">
                                <h6 class="card-title">عوامل التأثير الإضافية</h6>
                                
                                <!-- حدث خاص -->
                                <div class="mb-3">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="special_event" 
                                               name="special_event" onchange="toggleEventDescription()">
                                        <label class="form-check-label" for="special_event">
                                            هناك حدث خاص في هذا اليوم
                                        </label>
                                    </div>
                                    <input type="text" id="event_description" name="event_description" 
                                           class="form-control mt-2" placeholder="مثل: عطلة رسمية، احتفال..." 
                                           style="display:none;">
                                </div>

                                <!-- يوم عطلة -->
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" id="is_holiday" 
                                           name="is_holiday">
                                    <label class="form-check-label" for="is_holiday">
                                        هذا اليوم عطلة رسمية
                                    </label>
                                </div>
                            </div>
                        </div>

                        <!-- ملاحظات -->
                        <div class="mb-3">
                            <label for="notes" class="form-label">ملاحظات إضافية</label>
                            <textarea id="notes" name="notes" class="form-control" rows="3" 
                                      placeholder="أي معلومات إضافية عن هذا التوقع..."></textarea>
                        </div>

                        <!-- أزرار -->
                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('restaurant_advanced.forecast_list') }}" class="btn btn-secondary">إلغاء</a>
                            <button type="submit" class="btn btn-primary">إضافة التوقع</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// تحديث عرض مستوى الثقة
document.getElementById('confidence_level').addEventListener('input', function() {
    document.getElementById('confidence-display').textContent = this.value + '%';
});

// إظهار/إخفاء وصف الحدث
function toggleEventDescription() {
    const eventDesc = document.getElementById('event_description');
    eventDesc.style.display = document.getElementById('special_event').checked ? 'block' : 'none';
}

// تعيين التاريخ الافتراضي لـ غد
document.addEventListener('DOMContentLoaded', function() {
    const tomorrow = new Date();
    tomorrow.setDate(tomorrow.getDate() + 1);
    document.getElementById('forecast_date').value = tomorrow.toISOString().split('T')[0];
});
</script>

{% endblock %}