# ๐ ูุธุงู ุงูุตูุงุญูุงุช ุงูุดุงูู - CfpaZMS

## ูุธุฑุฉ ุนุงูุฉ
ุชู ุชุทููุฑ ูุธุงู ุตูุงุญูุงุช ูุชูุฏู ูุดุงูู ูุณูุญ ูููุฏูุฑูู ุจุฅุฏุงุฑุฉ ุตูุงุญูุงุช ุงููุณุชุฎุฏููู ุจุดูู ุฏููู ูุญุจูุจู (Granular Permissions).

## ุงูููุฒุงุช ุงูุฑุฆูุณูุฉ

### โ ุตูุงุญูุงุช ุญุจูุจูุฉ (Granular Permissions)
ุจุฏูุงู ูู ุงูุงุนุชูุงุฏ ุนูู ุงูุฃุฏูุงุฑ ููุทุ ููููู ุงูุขู ุชุญุฏูุฏ ุตูุงุญูุงุช ูุญุฏุฏุฉ ููู ูุณุชุฎุฏู:
- ุนุฑุถ ุงูุตูุญุงุช
- ุฅุถุงูุฉ ุจูุงูุงุช
- ุชุนุฏูู ุจูุงูุงุช
- ุญุฐู ุจูุงูุงุช
- ุชุตุฏูุฑ ุงูุจูุงูุงุช

### โ ุชุณุน ูุฆุงุช ุฑุฆูุณูุฉ ูู ุงูุตูุงุญูุงุช

#### 1๏ธโฃ ููุญุฉ ุงูุชุญูู (Dashboard)
- `dashboard_view`: ุนุฑุถ ููุญุฉ ุงูุชุญูู

#### 2๏ธโฃ ุฅุฏุงุฑุฉ ุงููุฎุฒูู (Inventory)
- `inventory_view`: ุนุฑุถ ูุงุฆูุฉ ุงูุฃุตูุงู
- `inventory_add`: ุฅุถุงูุฉ ุตูู ุฌุฏูุฏ
- `inventory_edit`: ุชุนุฏูู ุงูุฃุตูุงู
- `inventory_delete`: ุญุฐู ุงูุฃุตูุงู
- `inventory_export`: ุชุตุฏูุฑ ุงูุจูุงูุงุช

#### 3๏ธโฃ ุฅุฏุงุฑุฉ ุงูุชุตูููุงุช (Categories)
- `categories_view`: ุนุฑุถ ุงูุชุตูููุงุช
- `categories_add`: ุฅุถุงูุฉ ุชุตููู ุฌุฏูุฏ
- `categories_edit`: ุชุนุฏูู ุงูุชุตูููุงุช
- `categories_delete`: ุญุฐู ุงูุชุตูููุงุช

#### 4๏ธโฃ ุฅุฏุงุฑุฉ ุงูุนูููุงุช (Transactions)
- `transactions_view`: ุนุฑุถ ุงูุนูููุงุช
- `transactions_add`: ุชุณุฌูู ุนูููุฉ ุฌุฏูุฏุฉ
- `transactions_edit`: ุชุนุฏูู ุงูุนูููุงุช
- `transactions_delete`: ุญุฐู ุงูุนูููุงุช

#### 5๏ธโฃ ุฅุฏุงุฑุฉ ุงูููุฑุฏูู (Suppliers)
- `suppliers_view`: ุนุฑุถ ูุงุฆูุฉ ุงูููุฑุฏูู
- `suppliers_add`: ุฅุถุงูุฉ ููุฑุฏ ุฌุฏูุฏ
- `suppliers_edit`: ุชุนุฏูู ุจูุงูุงุช ุงูููุฑุฏูู
- `suppliers_delete`: ุญุฐู ุงูููุฑุฏูู
- `suppliers_orders`: ุฅุฏุงุฑุฉ ุฃูุงูุฑ ุงูุดุฑุงุก

#### 6๏ธโฃ ุฅุฏุงุฑุฉ ุงูุฃุตูู (Equipment/Assets)
- `equipment_view`: ุนุฑุถ ุงูุฃุตูู
- `equipment_add`: ุชุณุฌูู ุฃุตู ุฌุฏูุฏ
- `equipment_edit`: ุชุนุฏูู ุงูุฃุตูู
- `equipment_delete`: ุญุฐู ุงูุฃุตูู
- `equipment_issues`: ุฅุฏุงุฑุฉ ุงููุดุงูู ุงููุณุฌูุฉ

#### 7๏ธโฃ ุฅุฏุงุฑุฉ ุงููุทุนู (Restaurant)
- `recipes_view`: ุนุฑุถ ุงููุตูุงุช
- `recipes_add`: ุฅุถุงูุฉ ูุตูุฉ ุฌุฏูุฏุฉ
- `recipes_edit`: ุชุนุฏูู ุงููุตูุงุช
- `recipes_delete`: ุญุฐู ุงููุตูุงุช
- `meals_view`: ุนุฑุถ ุงููุฌุจุงุช ุงูููููุฉ
- `meals_add`: ุชุณุฌูู ูุฌุจุฉ ุฌุฏูุฏุฉ
- `meals_edit`: ุชุนุฏูู ุงููุฌุจุงุช
- `meals_delete`: ุญุฐู ุงููุฌุจุงุช

#### 8๏ธโฃ ุงูุชูุงุฑูุฑ (Reports)
- `reports_inventory`: ุชูุฑูุฑ ุญุฑูุฉ ุงููุฎุฒูู
- `reports_low_stock`: ุชูุฑูุฑ ุงูุฃุตูุงู ููุฎูุถุฉ ุงููุฎุฒูู
- `reports_equipment`: ุชูุฑูุฑ ุงูุฃุตูู
- `reports_meals`: ุชูุฑูุฑ ุงุณุชููุงู ุงููุฌุจุงุช
- `reports_print`: ุทุจุงุนุฉ ุงูุชูุงุฑูุฑ
- `reports_export`: ุชุตุฏูุฑ ุงูุชูุงุฑูุฑ

#### 9๏ธโฃ ุฅุฏุงุฑุฉ ุงููุธุงู (Admin)
- `users_view`: ุนุฑุถ ุงููุณุชุฎุฏููู
- `users_add`: ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ
- `users_edit`: ุชุนุฏูู ุงููุณุชุฎุฏููู
- `users_delete`: ุญุฐู ุงููุณุชุฎุฏููู
- `permissions_manage`: ุฅุฏุงุฑุฉ ุงูุตูุงุญูุงุช
- `activity_logs`: ุนุฑุถ ุณุฌู ุงููุดุงุท
- `settings`: ุฅุนุฏุงุฏุงุช ุงููุคุณุณุฉ

## ููููุฉ ุงุณุชุฎุฏุงู ุงููุธุงู

### ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ ูุน ุตูุงุญูุงุช
1. ุงูุชูู ุฅูู **ุงูุฅุฏุงุฑุฉ** โ **ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู** โ **ุฅุถุงูุฉ ูุณุชุฎุฏู ุฌุฏูุฏ**
2. ุฃุฏุฎู ุจูุงูุงุช ุงููุณุชุฎุฏู ุงูุดุฎุตูุฉ (ุงูุงุณูุ ุงูุจุฑูุฏุ ูููุฉ ุงููุฑูุฑุ ุฅูุฎ)
3. ุงุฎุชุฑ ุงูุฏูุฑ (ูุฏูุฑุ ููุธูุ ุฅูุฎ)
4. ูู ูุณู **ุงูุตูุงุญูุงุช**ุ ุงุฎุชุฑ ุงูุตูุงุญูุงุช ุงููุฑุงุฏ ููุญูุง ูููุณุชุฎุฏู ูู ุฎูุงู checkboxes
5. ุงููุฑ ุนูู **ุญูุธ ุงููุณุชุฎุฏู ุงูุฌุฏูุฏ**

### ุชุนุฏูู ุตูุงุญูุงุช ุงููุณุชุฎุฏู
1. ุงูุชูู ุฅูู **ุงูุฅุฏุงุฑุฉ** โ **ุฅุฏุงุฑุฉ ุงููุณุชุฎุฏููู**
2. ุงุจุญุซ ุนู ุงููุณุชุฎุฏู ูุงููุฑ ุนูู **ุชุนุฏูู**
3. ูู ูุณู **ุงูุตูุงุญูุงุช**ุ ูู ุจุชุญุฏูุซ ุงูุตูุงุญูุงุช ููุง ุชุฑูุฏ
4. ุงููุฑ ุนูู **ุญูุธ ุงูุชุบููุฑุงุช**

## ุงููููุงุช ุงููุถุงูุฉ/ุงููุนุฏูุฉ

### ูููุงุช ุฌุฏูุฏุฉ:
1. **`permissions_config.py`** - ูุงุฆูุฉ ุดุงููุฉ ุจุฌููุน ุงูุตูุงุญูุงุช ุงููุชุงุญุฉ
   - ุชุญุชูู ุนูู ุชุนุฑูู ุฌููุน ุงูุตูุงุญูุงุช ููุธูุฉ ุญุณุจ ุงููุฆุงุช
   - ุฏูุงู ูุณุงุนุฏุฉ ูููุตูู ุฅูู ุงูุตูุงุญูุงุช

### ูููุงุช ูุนุฏูุฉ:

#### 1. **`models.py`**
- ุชู ุฅุถุงูุฉ ูููุฐุฌ `UserPermission` ุงูุฌุฏูุฏ
- ุชู ุฅุถุงูุฉ ุนูุงูุฉ ุจูู `User` ู `UserPermission`
- ุชู ุฅุถุงูุฉ ุฏุงูุชูู ููุชุญูู ูู ุงูุตูุงุญูุงุช:
  - `has_granular_permission(permission_key)`: ุงูุชุญูู ูู ุตูุงุญูุฉ ูุญุฏุฏุฉ
  - `get_all_permissions()`: ุงูุญุตูู ุนูู ุฌููุน ุงูุตูุงุญูุงุช ุงููุณููุญุฉ

#### 2. **`routes/admin.py`**
- ุชู ุชุญุฏูุซ ุฏุงูุฉ `add_user()` ูุญูุธ ุงูุตูุงุญูุงุช ุงููุฎุชุงุฑุฉ
- ุชู ุชุญุฏูุซ ุฏุงูุฉ `edit_user()` ูุชุญุฏูุซ ุงูุตูุงุญูุงุช
- ุชู ุฅุถุงูุฉ ุฏุงูุฉ `_update_user_permissions()` ููุนุงูุฌุฉ ุญูุธ ุงูุตูุงุญูุงุช
- ุชูุฑูุฑ ุจูุงูุงุช ุงูุตูุงุญูุงุช ููููุงูุจ

#### 3. **`templates/admin/add_user.html`**
- ุชู ุฅุถุงูุฉ ูุณู **ุงูุตูุงุญูุงุช** ุจู checkboxes ูุฌููุน ุงูุตูุงุญูุงุช
- ููุธูุฉ ุญุณุจ ุงููุฆุงุช ูุชุณููู ุงูุงุฎุชูุงุฑ
- ุนุฑุถ ุจุตุฑู ุฌููู ูุณูู ุงูุงุณุชุฎุฏุงู

#### 4. **`templates/admin/edit_user.html`**
- ุชู ุฅุถุงูุฉ ูุณู **ุงูุตูุงุญูุงุช** ูุน ุนุฑุถ ุงูุตูุงุญูุงุช ุงููุฎุชุงุฑุฉ ูุณุจูุงู
- ูุญุงูุธ ุนูู ุงูุตูุงุญูุงุช ุงููุญููุธุฉ ููุณูุญ ุจุชุนุฏูููุง

#### 5. **`app.py`**
- ุชู ุฅุถุงูุฉ ุฏุงูุฉ context processor ูุฅุชุงุญุฉ `has_permission()` ูู ุฌููุน ุงูููุงูุจ
- ุชุณูุญ ุจูุญุต ุงูุตูุงุญูุงุช ูุจุงุดุฑุฉ ูู ููุงูุจ Jinja2

#### 6. **`init_db.py`**
- ุชู ุชุญุฏูุซ ูุฅุถุงูุฉ ุฌููุน ุงูุตูุงุญูุงุช ุชููุงุฆูุงู ูุญุณุงุจ ุงููุฏูุฑ ุนูุฏ ุฅูุดุงุก ูุงุนุฏุฉ ุงูุจูุงูุงุช
- ุฌุนู ุงููุฏูุฑ ูุฏูู ุฌููุน ุงูุตูุงุญูุงุช ุจุดูู ุงูุชุฑุงุถู

## ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู `user_permissions`
```
id                  - UUID (ุงูููุชุงุญ ุงูุฃุณุงุณู)
user_id            - UUID (ููุชุงุญ ุฃุฌูุจู ูุดูุฑ ุฅูู ุฌุฏูู users)
permission_key     - String (ููุชุงุญ ุงูุตูุงุญูุฉ - ูุซู: inventory_view)
permission_name    - String (ุงุณู ุงูุตูุงุญูุฉ ุงููุตูู)
permission_category - String (ุงููุฆุฉ: inventory, equipment, ุฅูุฎ)
is_allowed         - Boolean (ูู ุงูุตูุงุญูุฉ ูุณููุญุฉ)
created_at         - DateTime
updated_at         - DateTime
```

## ุงุณุชุฎุฏุงู ุงูุตูุงุญูุงุช ูู ุงูููุฏ

### ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูู ุงููุณุงุฑุงุช (Routes):
```python
@app.route('/inventory/items')
@login_required
def view_items():
    if not current_user.has_granular_permission('inventory_view'):
        flash('ููุณ ูุฏูู ุตูุงุญูุฉ ูููุตูู ุฅูู ูุฐู ุงูุตูุญุฉ', 'danger')
        return redirect(url_for('dashboard.index'))
    # ... ุจููุฉ ุงูููุฏ
```

### ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูู ุงูููุงูุจ (Templates):
```html
{% if has_permission('inventory_add') %}
    <a href="{{ url_for('inventory.add_item') }}" class="btn btn-primary">
        <i class="fas fa-plus"></i> ุฅุถุงูุฉ ุตูู ุฌุฏูุฏ
    </a>
{% endif %}
```

## ูุซุงู ุนููู

### ุฅูุดุงุก ูุณุชุฎุฏู "ุฃููู ูุฎุฒู" ูุน ุตูุงุญูุงุช ูุญุฏูุฏุฉ:
1. **ุจูุงูุงุช ุงููุณุชุฎุฏู:**
   - ุงูุงุณู: ุฃุญูุฏ ุนูู
   - ุงุณู ุงููุณุชุฎุฏู: ahmed_warehouse
   - ุงูุจุฑูุฏ: ahmed@example.com
   - ุงูุฏูุฑ: warehouse_manager

2. **ุงูุตูุงุญูุงุช:**
   - โ ุนุฑุถ ููุญุฉ ุงูุชุญูู
   - โ ุนุฑุถ ูุงุฆูุฉ ุงูุฃุตูุงู
   - โ ุฅุถุงูุฉ ุตูู ุฌุฏูุฏ
   - โ ุชุนุฏูู ุงูุฃุตูุงู
   - โ ุนุฑุถ ุงูุนูููุงุช
   - โ ุชุณุฌูู ุนูููุฉ ุฌุฏูุฏุฉ
   - โ ุชุนุฏูู ุงูุนูููุงุช

3. ุงููุชูุฌุฉ:
   - ุณูููู ุฃุญูุฏ ูุงุฏุฑุงู ุนูู ุชูููุฐ ููุท ุงูุฃูุดุทุฉ ุงููุณููุญ ุจูุง
   - ูู ูุณุชุทูุน ุงููุตูู ุฅูู ุฅุฏุงุฑุฉ ุงูููุฑุฏูู ุฃู ุงูุชูุงุฑูุฑ ุฃู ุฅุฏุงุฑุฉ ุงููุธุงู

## ุงูุฎุทูุงุช ุงูุชุงููุฉ (ุงููุณุชูุจู)

ูููู ุชูุณูุน ุงููุธุงู ุจุฅุถุงูุฉ:
1. **ูุฌููุนุงุช ุงูุตูุงุญูุงุช (Permission Groups)**: ูุฌููุนุงุช ุฌุงูุฒุฉ ูู ุงูุตูุงุญูุงุช (ูุซู: ูุฏูุฑ ุงููุฎุฒูุ ูุญุงุณุจุ ุฅูุฎ)
2. **ุงูุตูุงุญูุงุช ุงููุณุชูุฏุฉ ุฅูู ุงูุฃุฏูุงุฑ (Role-based Permissions)**: ุฑุจุท ุงูุตูุงุญูุงุช ุจุงูุฃุฏูุงุฑ ุชููุงุฆูุงู
3. **ุชุญูู ุฃูุซุฑ ุชูุตููุงู**: ุตูุงุญูุงุช ุนูู ูุณุชูู ุงูุจูุงูุงุช (ูุซู: ุงููุตูู ุฅูู ุฃูุณุงู ูุญุฏุฏุฉ ููุท)
4. **ุชูุงุฑูุฑ ุงูุตูุงุญูุงุช**: ุนุฑุถ ูู ูุฏูู ุฃู ุตูุงุญูุฉ ูุนููุฉ

## ุงูุฃูุงู ูุงูููุงุญุธุงุช

1. **ุฌููุน ุงูุตูุงุญูุงุช** ูุชู ูุญุตูุง ุนูู ุงูุฎุงุฏู (Server-side)
2. ูุง ุชุนุชูุฏ ุนูู ุงููุญูุตุงุช ูู ุงููุงุฌูุฉ ุงูุฃูุงููุฉ ููุท
3. ูุชู ุชุณุฌูู ุฌููุน ุงูุชุบููุฑุงุช ุนูู ุงูุตูุงุญูุงุช ูู ุณุฌู ุงููุดุงุท
4. ุงููุฏูุฑ (Admin) ูู ุฌููุน ุงูุตูุงุญูุงุช ุงูุชุฑุงุถูุงู
5. ูููู ุฅุถุงูุฉ ุตูุงุญูุงุช ุฌุฏูุฏุฉ ุจุณูููุฉ ูู `permissions_config.py`

## ุงูุฏุนู ูุงูุชุทููุฑ

ููุฅุจูุงุบ ุนู ูุดุงูู ุฃู ุงูุทูุจ ุจุฅุถุงูุฉ ุตูุงุญูุงุช ุฌุฏูุฏุฉุ ูุฑุฌู ุงูุชูุงุตู ูุน ูุฑูู ุงูุฏุนู.